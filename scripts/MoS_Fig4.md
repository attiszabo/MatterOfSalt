# Figure 4
Attila Szabo
2025-01-14

### Setting up the R environment

``` r
library(tidyverse)    # 2.0.0, 
                      # permute 0.9-7, lubridate    1.9.2, forcats  1.0.0, stringr  1.5.0, 
                      # dplyr   1.1.2, purrr    1.0.1, readr    2.1.4, tidyr    1.3.0, tibble   3.2.1, 
                      # ggplot2 3.4.2 # ensure this version for compatibility with ggtree and ggnewscale
library(indicspecies) # 1.7.14
library(ggtree)       # 3.10.0
library(ggnewscale)   # 0.4.9
library(ggtreeExtra)  # 1.12.0
```

``` r
seed <- 14560722
set.seed(seed)
# R version:
  getRversion()
```

    [1] '4.3.0'

``` r
# print package versions
  insta_pack <- installed.packages()[names(sessionInfo()$otherPkgs), "Version"]
  knitr::kable(insta_pack, format = "markdown", align = "l")
```

|              | x      |
|:-------------|:-------|
| ggtreeExtra  | 1.12.0 |
| ggnewscale   | 0.4.9  |
| ggtree       | 3.10.0 |
| indicspecies | 1.7.14 |
| permute      | 0.9-7  |
| lubridate    | 1.9.2  |
| forcats      | 1.0.0  |
| stringr      | 1.5.1  |
| dplyr        | 1.1.2  |
| purrr        | 1.0.2  |
| readr        | 2.1.4  |
| tidyr        | 1.3.1  |
| tibble       | 3.2.1  |
| ggplot2      | 3.4.2  |
| tidyverse    | 2.0.0  |

R version: 4.3.0

Seed is: 14560722

### Import data

``` r
# V4 OTUs
otu_table <- read.table("../data/V4_otutable99.shared", header = TRUE, dec = ".", na.strings = "?",
                        row.names = 2, sep ="\t") %>%
              select(-label, -numOtus)

# Sample metadata
meta <- read.csv("../data/V4_meta.csv", header = TRUE, na.strings = "?", row.names = 1,
                   fileEncoding = "latin1")

# Indicator OTUs merged with metadata
indi_data <- read.table("../data/indic_otus_data_type.txt", header=TRUE, na.strings = "?",
                        sep="\t", stringsAsFactors = FALSE, check.names = FALSE)  %>%
                        rename(., "label" = "otus")

otutax <- read.table("../data/V4_otus.98.80.80.taxonomy", header=TRUE,
                     row.names=2, sep="\t")
```

## Identifying OTUs indicating ionic composition types

``` r
# gather ionic composition type information of the samples:

ionic_comp_type <- meta$type

# perform the analysis for abundant OTUs (present with at least 1% relative abundance in one sample and present in 3 distinct samples (previously we rarefied to 2558 sequences per sample):

otu_abund <- otu_table %>%
  t() %>%
  as.data.frame() %>%
  filter(rowSums(. > 25) >= 1 & rowSums(. > 0) >= 3) %>%
  t() %>%
  as.data.frame()

# running the indicator species analysis from library 'indicspecies'

indicator_result <- multipatt(otu_abund, ionic_comp_type,
                              func = "r.g",
                              control = how(nperm=999))
summary_text <- capture.output(summary(indicator_result))
summary_text
```

      [1] ""                                                               
      [2] " Multilevel pattern analysis"                                   
      [3] " ---------------------------"                                   
      [4] ""                                                               
      [5] " Association function: r.g"                                     
      [6] " Significance level (alpha): 0.05"                              
      [7] ""                                                               
      [8] " Total number of species: 1275"                                 
      [9] " Selected number of species: 478 "                              
     [10] " Number of species associated to 1 group: 391 "                 
     [11] " Number of species associated to 2 groups: 83 "                 
     [12] " Number of species associated to 3 groups: 4 "                  
     [13] ""                                                               
     [14] " List of species associated to each combination: "              
     [15] ""                                                               
     [16] " Group freshwater  #sps.  171 "                                 
     [17] "          stat p.value    "                                     
     [18] "Otu00225 0.584   0.001 ***"                                     
     [19] "Otu00356 0.532   0.001 ***"                                     
     [20] "Otu00235 0.526   0.001 ***"                                     
     [21] "Otu00170 0.473   0.001 ***"                                     
     [22] "Otu00722 0.470   0.001 ***"                                     
     [23] "Otu00542 0.464   0.001 ***"                                     
     [24] "Otu00055 0.463   0.001 ***"                                     
     [25] "Otu00009 0.460   0.001 ***"                                     
     [26] "Otu00400 0.434   0.001 ***"                                     
     [27] "Otu00067 0.420   0.001 ***"                                     
     [28] "Otu00493 0.406   0.001 ***"                                     
     [29] "Otu00321 0.405   0.001 ***"                                     
     [30] "Otu00567 0.403   0.001 ***"                                     
     [31] "Otu00402 0.389   0.001 ***"                                     
     [32] "Otu00741 0.386   0.001 ***"                                     
     [33] "Otu00885 0.383   0.001 ***"                                     
     [34] "Otu00556 0.383   0.001 ***"                                     
     [35] "Otu00849 0.376   0.001 ***"                                     
     [36] "Otu00418 0.372   0.001 ***"                                     
     [37] "Otu00173 0.372   0.001 ***"                                     
     [38] "Otu00642 0.372   0.001 ***"                                     
     [39] "Otu00804 0.371   0.001 ***"                                     
     [40] "Otu00305 0.366   0.001 ***"                                     
     [41] "Otu00155 0.365   0.001 ***"                                     
     [42] "Otu00424 0.363   0.001 ***"                                     
     [43] "Otu00165 0.363   0.001 ***"                                     
     [44] "Otu00021 0.355   0.001 ***"                                     
     [45] "Otu00310 0.354   0.001 ***"                                     
     [46] "Otu00043 0.352   0.001 ***"                                     
     [47] "Otu01670 0.352   0.001 ***"                                     
     [48] "Otu00715 0.347   0.001 ***"                                     
     [49] "Otu00535 0.345   0.001 ***"                                     
     [50] "Otu00425 0.338   0.001 ***"                                     
     [51] "Otu00649 0.331   0.001 ***"                                     
     [52] "Otu00383 0.331   0.001 ***"                                     
     [53] "Otu00031 0.329   0.001 ***"                                     
     [54] "Otu00593 0.325   0.001 ***"                                     
     [55] "Otu01199 0.325   0.001 ***"                                     
     [56] "Otu00053 0.324   0.001 ***"                                     
     [57] "Otu00001 0.321   0.001 ***"                                     
     [58] "Otu01283 0.320   0.001 ***"                                     
     [59] "Otu00513 0.315   0.001 ***"                                     
     [60] "Otu00673 0.315   0.001 ***"                                     
     [61] "Otu00097 0.314   0.001 ***"                                     
     [62] "Otu00530 0.314   0.001 ***"                                     
     [63] "Otu00598 0.310   0.001 ***"                                     
     [64] "Otu00639 0.305   0.001 ***"                                     
     [65] "Otu00326 0.305   0.002 ** "                                     
     [66] "Otu00211 0.301   0.001 ***"                                     
     [67] "Otu00222 0.301   0.001 ***"                                     
     [68] "Otu01046 0.299   0.001 ***"                                     
     [69] "Otu00141 0.293   0.001 ***"                                     
     [70] "Otu01018 0.292   0.001 ***"                                     
     [71] "Otu00999 0.291   0.001 ***"                                     
     [72] "Otu00588 0.291   0.001 ***"                                     
     [73] "Otu00697 0.290   0.001 ***"                                     
     [74] "Otu01294 0.290   0.001 ***"                                     
     [75] "Otu00611 0.289   0.001 ***"                                     
     [76] "Otu01122 0.288   0.001 ***"                                     
     [77] "Otu00993 0.288   0.001 ***"                                     
     [78] "Otu01079 0.287   0.001 ***"                                     
     [79] "Otu00483 0.285   0.001 ***"                                     
     [80] "Otu01397 0.285   0.001 ***"                                     
     [81] "Otu01373 0.280   0.001 ***"                                     
     [82] "Otu00879 0.276   0.001 ***"                                     
     [83] "Otu00771 0.276   0.001 ***"                                     
     [84] "Otu01315 0.275   0.001 ***"                                     
     [85] "Otu00545 0.273   0.002 ** "                                     
     [86] "Otu00098 0.273   0.001 ***"                                     
     [87] "Otu00241 0.272   0.002 ** "                                     
     [88] "Otu00464 0.271   0.001 ***"                                     
     [89] "Otu00391 0.266   0.001 ***"                                     
     [90] "Otu00566 0.265   0.001 ***"                                     
     [91] "Otu01763 0.265   0.001 ***"                                     
     [92] "Otu01901 0.263   0.001 ***"                                     
     [93] "Otu01090 0.262   0.001 ***"                                     
     [94] "Otu00224 0.258   0.003 ** "                                     
     [95] "Otu01686 0.258   0.001 ***"                                     
     [96] "Otu01023 0.255   0.001 ***"                                     
     [97] "Otu00142 0.254   0.005 ** "                                     
     [98] "Otu00091 0.254   0.001 ***"                                     
     [99] "Otu01631 0.252   0.001 ***"                                     
    [100] "Otu00444 0.252   0.002 ** "                                     
    [101] "Otu00034 0.251   0.005 ** "                                     
    [102] "Otu00915 0.249   0.002 ** "                                     
    [103] "Otu01032 0.249   0.002 ** "                                     
    [104] "Otu01049 0.248   0.001 ***"                                     
    [105] "Otu01685 0.247   0.001 ***"                                     
    [106] "Otu02020 0.244   0.003 ** "                                     
    [107] "Otu02177 0.243   0.003 ** "                                     
    [108] "Otu00969 0.242   0.002 ** "                                     
    [109] "Otu00226 0.241   0.004 ** "                                     
    [110] "Otu00710 0.240   0.008 ** "                                     
    [111] "Otu01455 0.238   0.003 ** "                                     
    [112] "Otu00041 0.237   0.006 ** "                                     
    [113] "Otu00794 0.236   0.002 ** "                                     
    [114] "Otu00509 0.236   0.004 ** "                                     
    [115] "Otu00388 0.234   0.001 ***"                                     
    [116] "Otu00506 0.234   0.001 ***"                                     
    [117] "Otu01235 0.231   0.001 ***"                                     
    [118] "Otu01261 0.231   0.002 ** "                                     
    [119] "Otu01075 0.228   0.001 ***"                                     
    [120] "Otu01568 0.227   0.004 ** "                                     
    [121] "Otu00403 0.223   0.001 ***"                                     
    [122] "Otu00214 0.221   0.006 ** "                                     
    [123] "Otu01339 0.219   0.004 ** "                                     
    [124] "Otu00937 0.218   0.005 ** "                                     
    [125] "Otu01661 0.218   0.004 ** "                                     
    [126] "Otu00942 0.217   0.005 ** "                                     
    [127] "Otu01057 0.216   0.003 ** "                                     
    [128] "Otu00320 0.214   0.005 ** "                                     
    [129] "Otu00482 0.213   0.002 ** "                                     
    [130] "Otu00459 0.212   0.003 ** "                                     
    [131] "Otu01098 0.211   0.003 ** "                                     
    [132] "Otu00219 0.211   0.015 *  "                                     
    [133] "Otu00603 0.211   0.001 ***"                                     
    [134] "Otu01318 0.210   0.006 ** "                                     
    [135] "Otu00270 0.210   0.001 ***"                                     
    [136] "Otu00309 0.208   0.011 *  "                                     
    [137] "Otu00064 0.207   0.011 *  "                                     
    [138] "Otu01935 0.206   0.001 ***"                                     
    [139] "Otu00693 0.206   0.011 *  "                                     
    [140] "Otu01557 0.205   0.006 ** "                                     
    [141] "Otu01757 0.205   0.001 ***"                                     
    [142] "Otu02338 0.203   0.006 ** "                                     
    [143] "Otu01594 0.203   0.002 ** "                                     
    [144] "Otu00518 0.202   0.013 *  "                                     
    [145] "Otu01061 0.202   0.012 *  "                                     
    [146] "Otu03465 0.201   0.007 ** "                                     
    [147] "Otu01698 0.200   0.001 ***"                                     
    [148] "Otu00733 0.200   0.005 ** "                                     
    [149] "Otu01150 0.200   0.003 ** "                                     
    [150] "Otu00624 0.199   0.006 ** "                                     
    [151] "Otu02137 0.198   0.002 ** "                                     
    [152] "Otu00193 0.197   0.014 *  "                                     
    [153] "Otu01716 0.197   0.012 *  "                                     
    [154] "Otu00707 0.197   0.009 ** "                                     
    [155] "Otu01360 0.196   0.017 *  "                                     
    [156] "Otu01039 0.195   0.008 ** "                                     
    [157] "Otu01239 0.194   0.001 ***"                                     
    [158] "Otu00716 0.193   0.020 *  "                                     
    [159] "Otu00679 0.193   0.006 ** "                                     
    [160] "Otu01192 0.193   0.004 ** "                                     
    [161] "Otu00990 0.192   0.009 ** "                                     
    [162] "Otu02348 0.190   0.003 ** "                                     
    [163] "Otu00700 0.189   0.018 *  "                                     
    [164] "Otu01527 0.189   0.011 *  "                                     
    [165] "Otu01349 0.187   0.007 ** "                                     
    [166] "Otu00861 0.187   0.004 ** "                                     
    [167] "Otu00587 0.182   0.003 ** "                                     
    [168] "Otu01574 0.182   0.008 ** "                                     
    [169] "Otu00548 0.181   0.033 *  "                                     
    [170] "Otu00532 0.181   0.017 *  "                                     
    [171] "Otu00928 0.179   0.026 *  "                                     
    [172] "Otu01200 0.177   0.043 *  "                                     
    [173] "Otu01962 0.176   0.013 *  "                                     
    [174] "Otu02492 0.175   0.009 ** "                                     
    [175] "Otu00621 0.175   0.048 *  "                                     
    [176] "Otu00346 0.174   0.015 *  "                                     
    [177] "Otu01819 0.173   0.017 *  "                                     
    [178] "Otu01131 0.172   0.025 *  "                                     
    [179] "Otu00919 0.172   0.015 *  "                                     
    [180] "Otu00022 0.168   0.046 *  "                                     
    [181] "Otu00505 0.168   0.013 *  "                                     
    [182] "Otu00294 0.167   0.016 *  "                                     
    [183] "Otu00783 0.165   0.012 *  "                                     
    [184] "Otu02023 0.164   0.030 *  "                                     
    [185] "Otu01190 0.164   0.044 *  "                                     
    [186] "Otu01237 0.163   0.025 *  "                                     
    [187] "Otu00427 0.163   0.029 *  "                                     
    [188] "Otu01071 0.161   0.048 *  "                                     
    [189] ""                                                               
    [190] " Group saline  #sps.  115 "                                     
    [191] "          stat p.value    "                                     
    [192] "Otu00073 0.355   0.001 ***"                                     
    [193] "Otu00044 0.349   0.001 ***"                                     
    [194] "Otu00014 0.337   0.001 ***"                                     
    [195] "Otu00007 0.335   0.002 ** "                                     
    [196] "Otu00057 0.330   0.001 ***"                                     
    [197] "Otu00178 0.326   0.001 ***"                                     
    [198] "Otu00081 0.316   0.001 ***"                                     
    [199] "Otu00047 0.300   0.001 ***"                                     
    [200] "Otu01059 0.295   0.001 ***"                                     
    [201] "Otu00291 0.279   0.002 ** "                                     
    [202] "Otu00096 0.279   0.002 ** "                                     
    [203] "Otu00247 0.275   0.001 ***"                                     
    [204] "Otu00123 0.272   0.001 ***"                                     
    [205] "Otu00376 0.272   0.001 ***"                                     
    [206] "Otu01215 0.272   0.001 ***"                                     
    [207] "Otu00375 0.270   0.002 ** "                                     
    [208] "Otu00251 0.267   0.002 ** "                                     
    [209] "Otu00250 0.264   0.003 ** "                                     
    [210] "Otu00077 0.260   0.001 ***"                                     
    [211] "Otu00916 0.260   0.003 ** "                                     
    [212] "Otu00352 0.254   0.001 ***"                                     
    [213] "Otu00209 0.251   0.004 ** "                                     
    [214] "Otu00875 0.249   0.003 ** "                                     
    [215] "Otu00876 0.247   0.001 ***"                                     
    [216] "Otu00619 0.246   0.003 ** "                                     
    [217] "Otu00686 0.244   0.001 ***"                                     
    [218] "Otu00076 0.243   0.003 ** "                                     
    [219] "Otu01108 0.243   0.003 ** "                                     
    [220] "Otu00453 0.242   0.001 ***"                                     
    [221] "Otu00997 0.236   0.005 ** "                                     
    [222] "Otu00181 0.235   0.001 ***"                                     
    [223] "Otu00371 0.235   0.005 ** "                                     
    [224] "Otu00327 0.231   0.002 ** "                                     
    [225] "Otu00029 0.230   0.007 ** "                                     
    [226] "Otu00381 0.228   0.009 ** "                                     
    [227] "Otu01053 0.227   0.004 ** "                                     
    [228] "Otu00189 0.225   0.014 *  "                                     
    [229] "Otu00074 0.223   0.006 ** "                                     
    [230] "Otu00252 0.222   0.004 ** "                                     
    [231] "Otu00602 0.220   0.008 ** "                                     
    [232] "Otu00732 0.220   0.007 ** "                                     
    [233] "Otu00046 0.218   0.017 *  "                                     
    [234] "Otu00675 0.218   0.005 ** "                                     
    [235] "Otu01538 0.216   0.011 *  "                                     
    [236] "Otu00647 0.214   0.010 ** "                                     
    [237] "Otu00379 0.213   0.013 *  "                                     
    [238] "Otu00246 0.213   0.001 ***"                                     
    [239] "Otu00119 0.212   0.006 ** "                                     
    [240] "Otu00962 0.212   0.004 ** "                                     
    [241] "Otu00954 0.212   0.014 *  "                                     
    [242] "Otu00036 0.212   0.017 *  "                                     
    [243] "Otu00666 0.209   0.013 *  "                                     
    [244] "Otu00138 0.209   0.011 *  "                                     
    [245] "Otu00477 0.208   0.012 *  "                                     
    [246] "Otu00630 0.208   0.014 *  "                                     
    [247] "Otu00760 0.207   0.016 *  "                                     
    [248] "Otu00959 0.207   0.004 ** "                                     
    [249] "Otu00342 0.206   0.002 ** "                                     
    [250] "Otu00012 0.206   0.006 ** "                                     
    [251] "Otu00569 0.205   0.008 ** "                                     
    [252] "Otu00052 0.202   0.008 ** "                                     
    [253] "Otu00730 0.201   0.008 ** "                                     
    [254] "Otu00436 0.200   0.012 *  "                                     
    [255] "Otu00336 0.200   0.008 ** "                                     
    [256] "Otu00236 0.199   0.010 ** "                                     
    [257] "Otu00114 0.198   0.023 *  "                                     
    [258] "Otu00152 0.197   0.007 ** "                                     
    [259] "Otu00496 0.196   0.013 *  "                                     
    [260] "Otu00102 0.196   0.029 *  "                                     
    [261] "Otu00918 0.196   0.009 ** "                                     
    [262] "Otu00061 0.195   0.015 *  "                                     
    [263] "Otu00576 0.194   0.019 *  "                                     
    [264] "Otu00392 0.190   0.016 *  "                                     
    [265] "Otu00013 0.189   0.028 *  "                                     
    [266] "Otu01411 0.188   0.014 *  "                                     
    [267] "Otu00087 0.187   0.026 *  "                                     
    [268] "Otu00658 0.186   0.023 *  "                                     
    [269] "Otu00699 0.186   0.027 *  "                                     
    [270] "Otu00447 0.185   0.031 *  "                                     
    [271] "Otu00572 0.185   0.021 *  "                                     
    [272] "Otu01287 0.184   0.018 *  "                                     
    [273] "Otu00634 0.182   0.021 *  "                                     
    [274] "Otu01460 0.182   0.011 *  "                                     
    [275] "Otu01449 0.181   0.018 *  "                                     
    [276] "Otu02179 0.181   0.013 *  "                                     
    [277] "Otu00657 0.179   0.022 *  "                                     
    [278] "Otu00549 0.178   0.024 *  "                                     
    [279] "Otu00512 0.178   0.026 *  "                                     
    [280] "Otu00946 0.177   0.022 *  "                                     
    [281] "Otu00195 0.176   0.041 *  "                                     
    [282] "Otu00396 0.175   0.018 *  "                                     
    [283] "Otu01118 0.170   0.027 *  "                                     
    [284] "Otu00944 0.169   0.021 *  "                                     
    [285] "Otu01219 0.169   0.033 *  "                                     
    [286] "Otu00723 0.169   0.029 *  "                                     
    [287] "Otu00750 0.168   0.021 *  "                                     
    [288] "Otu00591 0.168   0.019 *  "                                     
    [289] "Otu00583 0.165   0.014 *  "                                     
    [290] "Otu00478 0.164   0.029 *  "                                     
    [291] "Otu00681 0.164   0.020 *  "                                     
    [292] "Otu00308 0.164   0.020 *  "                                     
    [293] "Otu01048 0.162   0.029 *  "                                     
    [294] "Otu00499 0.162   0.024 *  "                                     
    [295] "Otu00323 0.162   0.046 *  "                                     
    [296] "Otu01712 0.162   0.036 *  "                                     
    [297] "Otu00393 0.161   0.040 *  "                                     
    [298] "Otu01981 0.160   0.020 *  "                                     
    [299] "Otu00985 0.160   0.044 *  "                                     
    [300] "Otu00018 0.160   0.037 *  "                                     
    [301] "Otu01109 0.159   0.012 *  "                                     
    [302] "Otu01278 0.158   0.045 *  "                                     
    [303] "Otu01476 0.158   0.049 *  "                                     
    [304] "Otu03287 0.157   0.029 *  "                                     
    [305] "Otu01047 0.155   0.044 *  "                                     
    [306] "Otu00120 0.152   0.046 *  "                                     
    [307] ""                                                               
    [308] " Group soda  #sps.  32 "                                        
    [309] "          stat p.value   "                                      
    [310] "Otu00316 0.259   0.003 **"                                      
    [311] "Otu00255 0.246   0.005 **"                                      
    [312] "Otu00254 0.231   0.006 **"                                      
    [313] "Otu00558 0.229   0.010 **"                                      
    [314] "Otu00421 0.220   0.002 **"                                      
    [315] "Otu00048 0.218   0.015 * "                                      
    [316] "Otu00050 0.218   0.012 * "                                      
    [317] "Otu00696 0.215   0.007 **"                                      
    [318] "Otu00563 0.211   0.021 * "                                      
    [319] "Otu00110 0.205   0.018 * "                                      
    [320] "Otu00665 0.203   0.024 * "                                      
    [321] "Otu00373 0.203   0.014 * "                                      
    [322] "Otu00298 0.197   0.015 * "                                      
    [323] "Otu00694 0.190   0.031 * "                                      
    [324] "Otu00154 0.190   0.030 * "                                      
    [325] "Otu00604 0.189   0.021 * "                                      
    [326] "Otu01070 0.187   0.030 * "                                      
    [327] "Otu00179 0.186   0.041 * "                                      
    [328] "Otu00220 0.184   0.027 * "                                      
    [329] "Otu00107 0.182   0.037 * "                                      
    [330] "Otu00762 0.181   0.034 * "                                      
    [331] "Otu00751 0.181   0.035 * "                                      
    [332] "Otu00745 0.181   0.043 * "                                      
    [333] "Otu00692 0.181   0.038 * "                                      
    [334] "Otu00935 0.180   0.039 * "                                      
    [335] "Otu00659 0.179   0.044 * "                                      
    [336] "Otu00489 0.178   0.029 * "                                      
    [337] "Otu00737 0.177   0.033 * "                                      
    [338] "Otu00765 0.175   0.044 * "                                      
    [339] "Otu00289 0.174   0.031 * "                                      
    [340] "Otu00348 0.170   0.041 * "                                      
    [341] "Otu00198 0.165   0.047 * "                                      
    [342] ""                                                               
    [343] " Group soda-saline  #sps.  73 "                                 
    [344] "          stat p.value    "                                     
    [345] "Otu00109 0.538   0.001 ***"                                     
    [346] "Otu00059 0.533   0.001 ***"                                     
    [347] "Otu00025 0.508   0.001 ***"                                     
    [348] "Otu00368 0.496   0.001 ***"                                     
    [349] "Otu00163 0.471   0.001 ***"                                     
    [350] "Otu00166 0.459   0.001 ***"                                     
    [351] "Otu00035 0.453   0.001 ***"                                     
    [352] "Otu00340 0.444   0.001 ***"                                     
    [353] "Otu00188 0.438   0.001 ***"                                     
    [354] "Otu00115 0.387   0.001 ***"                                     
    [355] "Otu00419 0.385   0.001 ***"                                     
    [356] "Otu00461 0.365   0.001 ***"                                     
    [357] "Otu00508 0.365   0.001 ***"                                     
    [358] "Otu00475 0.344   0.001 ***"                                     
    [359] "Otu00813 0.340   0.001 ***"                                     
    [360] "Otu01459 0.337   0.001 ***"                                     
    [361] "Otu00398 0.327   0.001 ***"                                     
    [362] "Otu00315 0.326   0.001 ***"                                     
    [363] "Otu00099 0.323   0.001 ***"                                     
    [364] "Otu00676 0.320   0.001 ***"                                     
    [365] "Otu00204 0.310   0.001 ***"                                     
    [366] "Otu00473 0.299   0.001 ***"                                     
    [367] "Otu00199 0.295   0.001 ***"                                     
    [368] "Otu00158 0.294   0.001 ***"                                     
    [369] "Otu00156 0.290   0.001 ***"                                     
    [370] "Otu00159 0.279   0.003 ** "                                     
    [371] "Otu00117 0.276   0.001 ***"                                     
    [372] "Otu00395 0.271   0.001 ***"                                     
    [373] "Otu00409 0.269   0.003 ** "                                     
    [374] "Otu01213 0.265   0.001 ***"                                     
    [375] "Otu00641 0.260   0.001 ***"                                     
    [376] "Otu01543 0.256   0.002 ** "                                     
    [377] "Otu01420 0.254   0.001 ***"                                     
    [378] "Otu01153 0.254   0.004 ** "                                     
    [379] "Otu01020 0.253   0.001 ***"                                     
    [380] "Otu00337 0.251   0.004 ** "                                     
    [381] "Otu01403 0.250   0.001 ***"                                     
    [382] "Otu00399 0.241   0.010 ** "                                     
    [383] "Otu00313 0.240   0.005 ** "                                     
    [384] "Otu00627 0.239   0.002 ** "                                     
    [385] "Otu00299 0.233   0.011 *  "                                     
    [386] "Otu00775 0.232   0.003 ** "                                     
    [387] "Otu00149 0.226   0.005 ** "                                     
    [388] "Otu00494 0.223   0.005 ** "                                     
    [389] "Otu01063 0.222   0.006 ** "                                     
    [390] "Otu00582 0.221   0.001 ***"                                     
    [391] "Otu00540 0.219   0.005 ** "                                     
    [392] "Otu00816 0.217   0.006 ** "                                     
    [393] "Otu01007 0.217   0.002 ** "                                     
    [394] "Otu01909 0.217   0.001 ***"                                     
    [395] "Otu01394 0.213   0.004 ** "                                     
    [396] "Otu00845 0.212   0.009 ** "                                     
    [397] "Otu00372 0.205   0.019 *  "                                     
    [398] "Otu01180 0.202   0.014 *  "                                     
    [399] "Otu01310 0.200   0.012 *  "                                     
    [400] "Otu00843 0.195   0.028 *  "                                     
    [401] "Otu01952 0.194   0.001 ***"                                     
    [402] "Otu00958 0.191   0.013 *  "                                     
    [403] "Otu00839 0.188   0.022 *  "                                     
    [404] "Otu00445 0.187   0.029 *  "                                     
    [405] "Otu01176 0.182   0.014 *  "                                     
    [406] "Otu00533 0.181   0.033 *  "                                     
    [407] "Otu01228 0.180   0.032 *  "                                     
    [408] "Otu00259 0.177   0.035 *  "                                     
    [409] "Otu01238 0.177   0.030 *  "                                     
    [410] "Otu01138 0.175   0.020 *  "                                     
    [411] "Otu00938 0.171   0.032 *  "                                     
    [412] "Otu00351 0.171   0.035 *  "                                     
    [413] "Otu01107 0.169   0.005 ** "                                     
    [414] "Otu01266 0.168   0.017 *  "                                     
    [415] "Otu00810 0.164   0.036 *  "                                     
    [416] "Otu01918 0.164   0.040 *  "                                     
    [417] "Otu02952 0.163   0.024 *  "                                     
    [418] ""                                                               
    [419] " Group freshwater+saline  #sps.  2 "                            
    [420] "          stat p.value  "                                       
    [421] "Otu00011 0.209   0.019 *"                                       
    [422] "Otu00636 0.174   0.043 *"                                       
    [423] ""                                                               
    [424] " Group freshwater+soda  #sps.  4 "                              
    [425] "          stat p.value   "                                      
    [426] "Otu00062 0.270   0.002 **"                                      
    [427] "Otu00177 0.245   0.003 **"                                      
    [428] "Otu00468 0.198   0.024 * "                                      
    [429] "Otu00016 0.195   0.019 * "                                      
    [430] ""                                                               
    [431] " Group freshwater+soda-saline  #sps.  2 "                       
    [432] "          stat p.value  "                                       
    [433] "Otu00820 0.193   0.021 *"                                       
    [434] "Otu00280 0.183   0.041 *"                                       
    [435] ""                                                               
    [436] " Group saline+soda-saline  #sps.  2 "                           
    [437] "          stat p.value  "                                       
    [438] "Otu00160 0.193   0.027 *"                                       
    [439] "Otu00006 0.185   0.033 *"                                       
    [440] ""                                                               
    [441] " Group soda+soda-saline  #sps.  73 "                            
    [442] "          stat p.value    "                                     
    [443] "Otu00128 0.381   0.001 ***"                                     
    [444] "Otu00003 0.360   0.002 ** "                                     
    [445] "Otu00515 0.347   0.001 ***"                                     
    [446] "Otu00150 0.341   0.001 ***"                                     
    [447] "Otu00613 0.340   0.001 ***"                                     
    [448] "Otu00385 0.328   0.001 ***"                                     
    [449] "Otu00028 0.328   0.001 ***"                                     
    [450] "Otu00056 0.325   0.001 ***"                                     
    [451] "Otu00359 0.312   0.001 ***"                                     
    [452] "Otu00121 0.306   0.001 ***"                                     
    [453] "Otu00071 0.300   0.001 ***"                                     
    [454] "Otu00015 0.299   0.001 ***"                                     
    [455] "Otu00526 0.296   0.002 ** "                                     
    [456] "Otu00311 0.291   0.001 ***"                                     
    [457] "Otu00027 0.285   0.002 ** "                                     
    [458] "Otu00216 0.284   0.001 ***"                                     
    [459] "Otu00841 0.284   0.001 ***"                                     
    [460] "Otu00072 0.282   0.001 ***"                                     
    [461] "Otu00284 0.282   0.002 ** "                                     
    [462] "Otu00080 0.280   0.002 ** "                                     
    [463] "Otu00527 0.277   0.001 ***"                                     
    [464] "Otu00151 0.275   0.002 ** "                                     
    [465] "Otu00082 0.272   0.006 ** "                                     
    [466] "Otu00278 0.268   0.002 ** "                                     
    [467] "Otu00157 0.267   0.001 ***"                                     
    [468] "Otu00438 0.262   0.001 ***"                                     
    [469] "Otu00136 0.259   0.003 ** "                                     
    [470] "Otu00318 0.253   0.006 ** "                                     
    [471] "Otu00202 0.246   0.003 ** "                                     
    [472] "Otu00330 0.239   0.003 ** "                                     
    [473] "Otu00633 0.238   0.013 *  "                                     
    [474] "Otu00474 0.237   0.006 ** "                                     
    [475] "Otu00279 0.235   0.009 ** "                                     
    [476] "Otu00005 0.235   0.010 ** "                                     
    [477] "Otu00242 0.231   0.007 ** "                                     
    [478] "Otu00761 0.228   0.010 ** "                                     
    [479] "Otu00200 0.225   0.004 ** "                                     
    [480] "Otu00497 0.224   0.007 ** "                                     
    [481] "Otu00378 0.222   0.017 *  "                                     
    [482] "Otu00362 0.217   0.006 ** "                                     
    [483] "Otu01014 0.214   0.005 ** "                                     
    [484] "Otu00168 0.214   0.013 *  "                                     
    [485] "Otu01157 0.213   0.012 *  "                                     
    [486] "Otu00779 0.210   0.018 *  "                                     
    [487] "Otu00957 0.210   0.018 *  "                                     
    [488] "Otu00314 0.210   0.012 *  "                                     
    [489] "Otu01105 0.208   0.004 ** "                                     
    [490] "Otu00504 0.208   0.022 *  "                                     
    [491] "Otu00344 0.205   0.018 *  "                                     
    [492] "Otu00054 0.201   0.020 *  "                                     
    [493] "Otu01078 0.201   0.012 *  "                                     
    [494] "Otu00811 0.201   0.030 *  "                                     
    [495] "Otu00127 0.199   0.021 *  "                                     
    [496] "Otu00205 0.199   0.028 *  "                                     
    [497] "Otu00143 0.191   0.034 *  "                                     
    [498] "Otu00153 0.190   0.034 *  "                                     
    [499] "Otu00126 0.190   0.032 *  "                                     
    [500] "Otu00451 0.189   0.034 *  "                                     
    [501] "Otu01130 0.188   0.035 *  "                                     
    [502] "Otu00146 0.185   0.037 *  "                                     
    [503] "Otu00093 0.185   0.048 *  "                                     
    [504] "Otu00752 0.184   0.041 *  "                                     
    [505] "Otu00801 0.183   0.030 *  "                                     
    [506] "Otu01837 0.183   0.014 *  "                                     
    [507] "Otu00281 0.183   0.032 *  "                                     
    [508] "Otu00514 0.182   0.048 *  "                                     
    [509] "Otu00537 0.181   0.018 *  "                                     
    [510] "Otu00828 0.176   0.040 *  "                                     
    [511] "Otu00218 0.174   0.026 *  "                                     
    [512] "Otu00215 0.173   0.048 *  "                                     
    [513] "Otu00596 0.170   0.033 *  "                                     
    [514] "Otu00796 0.167   0.050 *  "                                     
    [515] "Otu00758 0.166   0.048 *  "                                     
    [516] ""                                                               
    [517] " Group freshwater+soda+soda-saline  #sps.  1 "                  
    [518] "          stat p.value  "                                       
    [519] "Otu00039 0.191   0.044 *"                                       
    [520] ""                                                               
    [521] " Group saline+soda+soda-saline  #sps.  3 "                      
    [522] "          stat p.value    "                                     
    [523] "Otu00002 0.372   0.001 ***"                                     
    [524] "Otu00116 0.178   0.038 *  "                                     
    [525] "Otu00004 0.177   0.037 *  "                                     
    [526] "---"                                                            
    [527] "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 "

``` r
# writeLines(summary_text, "indicator_summary.txt")
```

## Formatting metadata for tree visualization

``` r
# the previous list of indicator OTUs were reformatted and merged with sample metadata to create a dataframe ('indic_otus_data_type.txt') we can use for tree visualization
# highlight salinity preference of each indicator OTU by weighting OTU abundance with sample salinity and getting its mean: 

# get OTU taxonomy from the TaxAss results

indi_otutax <- otutax[rownames(otutax) %in% indi_data$label, ]
indi_spec <- as.list(row.names(indi_otutax))
indi_otu <- t(otu_table) %>%
            .[rownames(.) %in% indi_spec, ] %>%
            t() %>%
            as.data.frame()

indi_otu_sal <- indi_otu * as.numeric(meta$Salinity)
indi_otu_sal_filt <- indi_otu_sal[complete.cases(indi_otu_sal),]
w_sal_list <- colSums(indi_otu_sal_filt)/colSums(indi_otu_sal_filt > 0)

indi_data_salw <- merge(w_sal_list, indi_data, by.x="row.names", by.y="label")
indi_data_sal <- rename(indi_data_salw, "label" = "Row.names", "w_sal_mean" = "x")

l_indi_data_sal <-pivot_longer(indi_data_sal, cols = 3:6)
l_indi_data_sal$name <- factor(l_indi_data_sal$name, levels=c("freshwater", "soda", "soda-saline", "saline"))
```

## Creating a phylogenetic tree

To create a phylogenetic tree of the indicator OTUs (n = 474), we will
get back to mothur. Indicator OTU IDs were extracted from
‘indicator_summary.txt’ to create a mothur compatible list
‘indicotus.accnos’ Then using mothur we obtain the corresponding
sequences from our representative OTU file:

``` bash
mothur "#get.seqs(accnos=indicotus.accnos, fasta=otu.rep.mod.fasta)"

"Selected 474 sequences from your fasta file."

"Output File Names:"
"otu.rep.mod.pick.fasta"

And use the implementation of the clearcut program Sheneman et al., 2006; Bioinformatics) to create a tree: 

mothur "#clearcut(fasta=otu.rep.mod.pick.fasta, DNA=T, version=T)

"Output File Names:"
"otu.rep.mod.pick.tre"
```

## Visualizing phylogenetic tree of the indicator OTUs

``` r
# import the newick formatted phylogenetic tree created with mothur for the indicator OTUs

inditree <- read.tree("../data/otu.rep.mod.pick.tre")

# visualize with ggtree

q <- ggtree(inditree, layout = "radial")
q
```

![](MoS_Fig4_files/figure-commonmark/building%20tree-1.png)

``` r
# mapping node numbers

q + geom_text(aes(label=node), size = 1)
```

![](MoS_Fig4_files/figure-commonmark/building%20tree-2.png)

``` r
# defining colours of ionic composition types

cols <- c("freshwater" = "#B6E665", 
          "soda" ="#F8766D",
          "soda-saline" = "#C77CFF",
          "saline" = "#00BFC4")

# highlighting bacterial phyla

phyla <- data.frame(node=c(852, 777, 487, 609, 767, 903, 931, 888), phyl=c("Cyanobacteriota", "Actinomycetota", "Bacteroidota", "Pseudomonadota", "Gemmatimonadota",  "Verrucomicrobiota", "Planctomycetota",  "Patescibacteria"))

# highlighting monophyletic groups representing a given type

inner_nodes <- data.frame(node=c(675, 794, 906, 767, 838, 507, 543, 653), 
                          lineage=c("betI", "Frankiales", "Verrucomicrobiales", "Gemmatimonadota",
                                    "Nitriliruptorales", "Cytophagales", "Flavobacteriaceae", "Enterobacterales"))

phyl_cols <- c("Cyanobacteriota" = "paleturquoise1", "Actinomycetota" = "coral1", 
               "Bacteroidota" = "olivedrab3", "Pseudomonadota" = "dodgerblue3",
               "Gemmatimonadota" = "darkgoldenrod2",  "Verrucomicrobiota" = "deepskyblue",
               "Planctomycetota" = "yellow3", "Patescibacteria" = "hotpink4")

# colour the tree

pp <- q + geom_hilight(data=phyla, aes(node=node, fill=phyl), alpha =.4) +
          scale_fill_manual(name = "Phylum", values = phyl_cols,
                            guide = guide_legend(keywidth= 0.5,
                                                 keyheight= 0.5,
                                                 ncol = 2,
                                                 face = "bold",
                                                 title.position = "top"
                                                             )) +
          new_scale_fill() +
          geom_nodepoint(aes(subset = node == 675), fill="#B6E665",  size = 1.5, shape = 21, 
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 794), fill="#B6E665",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 906), fill="#F8766D",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 767), fill="#F8766D",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 838), fill="#F8766D",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 507), fill="#F8766D",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 543), fill="#00BFC4",  size = 1.5, shape = 21,
                         alpha =.9) +
          geom_nodepoint(aes(subset = node == 653), fill="#00BFC4",  size = 1.5, shape = 21,
                         alpha =.9)

pp
```

![](MoS_Fig4_files/figure-commonmark/building%20tree-3.png)

``` r
# create a heatmap which ionic composition type indicated by a given OTU, add weighted salinity means


pqr <- pp + new_scale_fill() +
            geom_fruit(data=l_indi_data_sal, geom=geom_tile,
                  mapping=aes(y=label, x = name, fill = name, alpha = value),
                  color = "grey50", size= 0.05, offset=0.04, height = 2) +
            scale_fill_manual(
                  name="Ionic composition type", values=cols, na.translate=FALSE,
                  guide=guide_legend(face = "bold",
                              keywidth=0.3,
                              keyheight=0.3,
                              nrow = 4,
                              title.position = "top"
                                      )) +
            scale_alpha_continuous(guide = "none", range = c(0, 1)) +
            new_scale_fill() + 
            geom_fruit(data=indi_data_sal, geom = geom_bar, 
                  mapping = aes(y = label, x = w_sal_mean), fill = "cadetblue3", pwidth=0.38,
                  col = "grey75", lwd = 0.1, orientation="y", stat="identity")
    
pqr + theme(legend.position = "bottom",
            legend.box = "horizontal",
            legend.justification = "center",
            legend.key.width = unit(0.5, "cm"),
            legend.key.height = unit(1, "cm"),
            legend.margin = margin(0, 0, 0, 0),
            plot.margin = margin(0, 0, 0, 0),
            text = element_text(size=12))
```

![](MoS_Fig4_files/figure-commonmark/building%20tree-4.png)

``` r
ggsave("Fig4.png", device = "png", scale = 1, width = 180, height = 180, units = c("mm"), dpi = 600)
ggsave("Fig4.svg", device = "svg", scale = 1, width = 180, height = 180, units = c("mm"), dpi = 600)
```
